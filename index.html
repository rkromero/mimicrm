<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==">
    <title>MIMI CRM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <!-- Librería para generar archivos Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Botón de menú móvil -->
    <button class="menu-toggle hide-on-desktop">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Overlay para móvil -->
    <div class="sidebar-overlay"></div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                <img src="img/logo-mimi.png" alt="MIMI CRM" style="height: 90px; display: block; margin-left: 0; margin-right: auto;">
            </div>
            
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Pedidos</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Pagos</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-box"></i>
                    <span>Productos</span>
                </a>
                <a href="#" class="nav-item" data-section="contactos">
                    <i class="fas fa-address-book"></i>
                    <span>Contactos</span>
                </a>
                <a href="#" class="nav-item" id="fabrica-nav">
                    <i class="fas fa-industry"></i>
                    <span>Fábrica</span>
                </a>
                <a href="#" class="nav-item" id="admin-profiles-nav" style="display:none">
                    <i class="fas fa-users-cog"></i>
                    <span>Administrar Perfiles</span>
                </a>
            </nav>

            <div class="sidebar-user">
                <div class="user-info">
                    <span id="sidebar-user-avatar-container">
                        <i class="fas fa-user sidebar-user-avatar" id="sidebar-user-avatar-icon"></i>
                    </span>
                    <span id="current-user-name">Usuario</span>
                </div>
                <div class="user-menu">
                    <a href="#" id="user-preferences">
                        <i class="fas fa-user-cog"></i>
                        Preferencias de Usuario
                    </a>
                    <a href="#" id="logout">
                        <i class="fas fa-sign-out-alt"></i>
                        Cerrar Sesión
                    </a>
                </div>
            </div>
        </aside>

        <!-- Contenido Principal -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="flex items-center gap-2">
                    <h1>Dashboard</h1>
                </div>
                <div class="flex items-center gap-2">
                    <button id="new-client-btn" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Nuevo Cliente
                    </button>
                    <button id="new-order-btn" class="btn btn-primary">
                        <i class="fas fa-shopping-cart"></i> Nuevo Pedido
                    </button>
                    <button id="new-payment-btn" class="btn btn-primary">
                        <i class="fas fa-money-bill-wave"></i> Nuevo Pago
                    </button>
                </div>
            </header>

            <!-- Sección de Pedidos -->
            <div id="pedidos-section" class="page-content" style="display:none;">
                <div class="table-container">
                    <div class="flex justify-between items-center mb-4">
                        <h2>Pedidos</h2>
                        <div class="flex gap-2">
                            <input type="text" class="input" placeholder="Buscar pedido..." id="orders-search">
                            <button id="new-order-btn-section" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Nuevo Pedido
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="clients-table">
                            <thead>
                                <tr>
                                    <th>Número</th>
                                    <th>Cliente</th>
                                    <th>Descripción</th>
                                    <th>Monto</th>
                                    <th>Estado</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body">
                                <!-- Los pedidos se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Sección de Pagos -->
            <div id="pagos-section" class="page-content" style="display:none;">
                <div class="table-container">
                    <div class="flex justify-between items-center mb-4">
                        <h2>Pagos</h2>
                        <div class="flex gap-2">
                            <input type="text" class="input" placeholder="Buscar pago..." id="payments-search">
                            <button id="new-payment-btn-section" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Nuevo Pago
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="clients-table">
                            <thead>
                                <tr>
                                    <th>Cliente</th>
                                    <th>Monto</th>
                                    <th>Método</th>
                                    <th>Referencia</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="payments-table-body">
                                <!-- Los pagos se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Sección de Productos -->
            <div id="productos-section" class="page-content" style="display:none;">
                <div class="table-container">
                    <div class="flex justify-between items-center mb-4">
                        <h2>Productos</h2>
                        <div class="flex gap-2">
                            <input type="text" class="input" placeholder="Buscar producto..." id="products-search">
                            <button id="new-product-btn" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Nuevo Producto
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="clients-table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Descripción</th>
                                    <th>Precio</th>
                                    <th>Stock</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="products-table-body">
                                <!-- Los productos se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Sección de Contactos -->
            <div id="contactos-section" class="page-content" style="display:none;">
                <div class="table-container">
                    <div class="flex justify-between items-center mb-4">
                        <h2>Contactos</h2>
                        <div class="flex gap-2">
                            <input type="text" class="input" placeholder="Buscar contacto..." id="contacts-search">
                            <button id="new-contact-btn-section" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Nuevo Contacto
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="clients-table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Cliente</th>
                                    <th>Email</th>
                                    <th>Teléfono</th>
                                    <th>Cargo</th>
                                    <th>Departamento</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="contacts-table-body">
                                <!-- Los contactos se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Contenido del Dashboard -->
            <div id="dashboard-section" class="page-content">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Resumen General</h3>
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="card-content">
                            <div class="stat-item">
                                <span class="stat-label">Total Clientes</span>
                                <span class="stat-value" id="total-clients">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Pedidos Activos</span>
                                <span class="stat-value" id="total-orders">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Productos</span>
                                <span class="stat-value" id="total-products">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Actividad Reciente</h3>
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="card-content">
                            <div id="recent-activity">
                                <p class="text-center text-gray-500">No hay actividad reciente</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Acciones Rápidas</h3>
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="card-content">
                            <div class="quick-actions">
                                <button class="quick-action-btn" onclick="showModal('new-client-modal')">
                                    <i class="fas fa-user-plus"></i>
                                    <span>Nuevo Cliente</span>
                                </button>
                                <button class="quick-action-btn" onclick="showModal('new-order-modal')">
                                    <i class="fas fa-shopping-cart"></i>
                                    <span>Nuevo Pedido</span>
                                </button>
                                <button class="quick-action-btn" onclick="showModal('new-payment-modal')">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>Nuevo Pago</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Segunda fila de tarjetas -->
                <div class="dashboard-grid" style="margin-top: 1.5rem;">
                    <div class="dashboard-card clickable-card" id="inactive-clients-card">
                        <div class="card-header">
                            <h3>Clientes Inactivos</h3>
                            <i class="fas fa-user-clock"></i>
                        </div>
                        <div class="card-content">
                            <div class="stat-item">
                                <span class="stat-label">Sin pedidos últimos 30 días</span>
                                <span class="stat-value" id="inactive-clients-count">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Última actividad</span>
                                <span class="stat-value" id="last-activity-date">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Ventas Completadas</h3>
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-content">
                            <div class="date-filter-section" style="margin-bottom: 1rem;">
                                <div style="display: flex; gap: 0.5rem; align-items: center; font-size: 0.875rem;">
                                    <input type="date" id="sales-date-from" class="input" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                    <span>hasta</span>
                                    <input type="date" id="sales-date-to" class="input" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                    <button type="button" id="filter-sales-btn" class="btn btn-primary" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">
                                        <i class="fas fa-filter"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total Vendido</span>
                                <span class="stat-value" id="total-sales-amount">$0.00</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Pedidos Completados</span>
                                <span class="stat-value" id="completed-orders-count">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card clickable-card" id="pending-collections-card">
                        <div class="card-header">
                            <h3>Por Cobrar</h3>
                            <i class="fas fa-money-bill-alt"></i>
                        </div>
                        <div class="card-content">
                            <div class="stat-item">
                                <span class="stat-label">Monto Pendiente</span>
                                <span class="stat-value" id="pending-amount">$0.00</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Pedidos vs Pagos</span>
                                <span class="stat-value" id="pending-ratio">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección de Clientes -->
            <div id="clientes-section" class="page-content" style="display:none;">
                <div class="table-container mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <h2>Clientes</h2>
                        <div class="flex gap-2">
                            <input type="text" class="input" placeholder="Buscar cliente..." id="client-list-search">
                            <button id="new-client-btn-section" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Nuevo Cliente
                            </button>
                        </div>
                    </div>
                    <div id="clients-list"></div>
                </div>
            </div>

            <!-- Sección de Fábrica -->
            <div id="fabrica-section" class="page-content" style="display:none;">
                <div class="table-container">
                    <div class="flex justify-between items-center mb-4">
                        <h2>Fábrica - Pedidos para Fabricar</h2>
                        <div class="flex gap-2">
                            <input type="text" class="input" placeholder="Buscar pedido..." id="fabrica-search">
                            <div class="stat-badge" style="background: #dbeafe; color: #1e40af; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 600;">
                                <span id="fabrica-count">0</span> pedidos pendientes
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="clients-table">
                            <thead>
                                <tr>
                                    <th>Número</th>
                                    <th>Cliente</th>
                                    <th>Descripción</th>
                                    <th>Monto</th>
                                    <th>Estado</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="fabrica-table-body">
                                <!-- Los pedidos para fabricar se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de Nuevo Cliente -->
    <div id="new-client-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nuevo Cliente</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-form">
                <form id="new-client-form">
                    <div class="form-group">
                        <label for="client-name-input">Nombre Completo</label>
                        <input type="text" id="client-name-input" name="nombre" class="input" autocomplete="name" required>
                    </div>
                    <div class="form-group">
                        <label for="client-rut-input">Documento</label>
                        <input type="text" id="client-rut-input" name="documento" class="input" autocomplete="off" required>
                    </div>
                    <div class="form-group">
                        <label for="client-email-input">Email</label>
                        <input type="email" id="client-email-input" name="email" class="input" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label for="client-phone-input">Teléfono</label>
                        <input type="tel" id="client-phone-input" name="telefono" class="input" autocomplete="tel" required>
                    </div>
                    <div class="form-group">
                        <label for="client-address-input">Dirección de Entrega</label>
                        <input type="text" id="client-address-input" name="direccion" class="input" autocomplete="street-address" required>
                    </div>
                    <div class="form-group">
                        <label for="client-province-input">Provincia</label>
                        <select id="client-province-input" name="provincia" class="input" autocomplete="address-level1" required>
                            <option value="">Seleccione una provincia</option>
                            <option value="Buenos Aires">Buenos Aires</option>
                            <option value="Ciudad Autonoma de Buenos Aires">Ciudad Autónoma de Buenos Aires</option>
                            <option value="Catamarca">Catamarca</option>
                            <option value="Chaco">Chaco</option>
                            <option value="Chubut">Chubut</option>
                            <option value="Cordoba">Córdoba</option>
                            <option value="Corrientes">Corrientes</option>
                            <option value="Entre Rios">Entre Ríos</option>
                            <option value="Formosa">Formosa</option>
                            <option value="Jujuy">Jujuy</option>
                            <option value="La Pampa">La Pampa</option>
                            <option value="La Rioja">La Rioja</option>
                            <option value="Mendoza">Mendoza</option>
                            <option value="Misiones">Misiones</option>
                            <option value="Neuquen">Neuquén</option>
                            <option value="Rio Negro">Río Negro</option>
                            <option value="Salta">Salta</option>
                            <option value="San Juan">San Juan</option>
                            <option value="San Luis">San Luis</option>
                            <option value="Santa Cruz">Santa Cruz</option>
                            <option value="Santa Fe">Santa Fe</option>
                            <option value="Santiago del Estero">Santiago del Estero</option>
                            <option value="Tierra del Fuego">Tierra del Fuego</option>
                            <option value="Tucuman">Tucumán</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="client-city-input">Ciudad</label>
                        <select id="client-city-input" name="ciudad" class="input" autocomplete="address-level2" required>
                            <option value="">Seleccione una ciudad</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="client-locality-input">Localidad</label>
                        <select id="client-locality-input" name="localidad" class="input" autocomplete="address-level3" required>
                            <option value="">Seleccione una localidad</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="client-zip-input">Código Postal</label>
                        <input type="text" id="client-zip-input" name="codigo_postal" class="input" autocomplete="postal-code" required>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary close-modal cancel-btn">Cancelar</button>
                <button type="submit" form="new-client-form" class="btn btn-primary submit-btn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Nuevo Pedido -->
    <div id="new-order-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Nuevo Pedido</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-form">
                <form id="new-order-form">
                    <div class="form-group">
                        <label for="order-client-select">Cliente</label>
                        <select id="order-client-select" class="input" autocomplete="off" required>
                            <option value="">Seleccione un cliente</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="order-description">Descripción del Pedido</label>
                        <textarea id="order-description" class="input" autocomplete="off" placeholder="Descripción general del pedido" required></textarea>
                    </div>

                    <!-- Sección de Productos -->
                    <div class="form-group">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <label style="margin: 0; font-weight: 600;">Productos del Pedido</label>
                            <button type="button" id="add-product-btn" class="btn btn-success" style="padding: 0.5rem 1rem;">
                                <i class="fas fa-plus"></i> Agregar Producto
                            </button>
                        </div>
                        
                        <!-- Selector de producto (inicialmente oculto) -->
                        <div id="product-selector" style="display: none; background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 1rem; align-items: end;">
                                <div>
                                    <label for="product-select">Producto</label>
                                    <select id="product-select" class="input">
                                        <option value="">Seleccione un producto</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="product-quantity">Cantidad</label>
                                    <input type="number" id="product-quantity" class="input" min="1" value="1">
                                </div>
                                <div>
                                    <label for="product-price">Precio Unitario</label>
                                    <input type="number" id="product-price" class="input" step="0.01" min="0">
                                </div>
                                <div>
                                    <button type="button" id="confirm-add-product" class="btn btn-primary" style="padding: 0.75rem;">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button type="button" id="cancel-add-product" class="btn btn-secondary" style="padding: 0.75rem; margin-left: 0.5rem;">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Lista de productos agregados -->
                        <div id="order-products-list">
                            <div id="no-products-message" style="text-align: center; padding: 2rem; color: #6b7280; background: #f9fafb; border-radius: 8px;">
                                <i class="fas fa-box-open" style="font-size: 2rem; margin-bottom: 0.5rem; display: block; color: #d1d5db;"></i>
                                <p style="margin: 0;">No hay productos agregados al pedido</p>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem;">Haga clic en "Agregar Producto" para comenzar</p>
                            </div>
                        </div>
                    </div>

                    <!-- Total del pedido -->
                    <div class="form-group" style="background: #f0f9ff; padding: 1rem; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                        <div style="display: flex; justify-content: between; align-items: center;">
                            <span style="font-weight: 600; color: #0c4a6e;">Total del Pedido:</span>
                            <span id="order-total" style="font-size: 1.5rem; font-weight: bold; color: #0ea5e9;">$0.00</span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary close-modal cancel-btn">Cancelar</button>
                <button type="submit" form="new-order-form" class="btn btn-primary submit-btn" id="submit-order-btn" disabled>Crear Pedido</button>
            </div>
        </div>
    </div>

    <!-- Modal de Nuevo Pago -->
    <div id="new-payment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nuevo Pago</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-form">
                <form id="new-payment-form">
                    <div class="form-group">
                        <label for="payment-client-select">Cliente</label>
                        <select id="payment-client-select" class="input" autocomplete="off" required>
                            <option value="">Seleccione un cliente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-amount">Monto</label>
                        <input type="number" id="payment-amount" class="input" autocomplete="off" required>
                    </div>
                    <div class="form-group">
                        <label for="payment-method">Método de Pago</label>
                        <select id="payment-method" class="input" autocomplete="off" required>
                            <option value="efectivo">Efectivo</option>
                            <option value="transferencia">Transferencia</option>
                            <option value="tarjeta">Tarjeta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-reference">Referencia</label>
                        <input type="text" id="payment-reference" class="input" autocomplete="off" required>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary close-modal cancel-btn">Cancelar</button>
                <button type="submit" form="new-payment-form" class="btn btn-primary submit-btn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Editar Pedido -->
    <div id="edit-order-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Editar Pedido</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-form">
                <form id="edit-order-form">
                    <div class="form-group">
                        <label for="edit-order-client-select">Cliente</label>
                        <select id="edit-order-client-select" class="input" autocomplete="off" required>
                            <option value="">Seleccione un cliente</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-order-description">Descripción del Pedido</label>
                        <textarea id="edit-order-description" class="input" autocomplete="off" placeholder="Descripción general del pedido" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="edit-order-status">Estado</label>
                        <select id="edit-order-status" class="input" autocomplete="off" required>
                            <option value="pendiente de pago">Pendiente de Pago</option>
                            <option value="fabricar">Fabricar</option>
                            <option value="sale fabrica">Sale Fábrica</option>
                            <option value="completado">Completado</option>
                        </select>
                    </div>

                    <!-- Sección de Productos -->
                    <div class="form-group">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <label style="margin: 0; font-weight: 600;">Productos del Pedido</label>
                            <button type="button" id="edit-add-product-btn" class="btn btn-success" style="padding: 0.5rem 1rem;">
                                <i class="fas fa-plus"></i> Agregar Producto
                            </button>
                        </div>
                        
                        <!-- Selector de producto (inicialmente oculto) -->
                        <div id="edit-product-selector" style="display: none; background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 1rem; align-items: end;">
                                <div>
                                    <label for="edit-product-select">Producto</label>
                                    <select id="edit-product-select" class="input">
                                        <option value="">Seleccione un producto</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="edit-product-quantity">Cantidad</label>
                                    <input type="number" id="edit-product-quantity" class="input" min="1" value="1">
                                </div>
                                <div>
                                    <label for="edit-product-price">Precio Unitario</label>
                                    <input type="number" id="edit-product-price" class="input" step="0.01" min="0">
                                </div>
                                <div>
                                    <button type="button" id="edit-confirm-add-product" class="btn btn-primary" style="padding: 0.75rem;">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button type="button" id="edit-cancel-add-product" class="btn btn-secondary" style="padding: 0.75rem; margin-left: 0.5rem;">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Lista de productos agregados -->
                        <div id="edit-order-products-list">
                            <div id="edit-no-products-message" style="text-align: center; padding: 2rem; color: #6b7280; background: #f9fafb; border-radius: 8px;">
                                <i class="fas fa-box-open" style="font-size: 2rem; margin-bottom: 0.5rem; display: block; color: #d1d5db;"></i>
                                <p style="margin: 0;">No hay productos en este pedido</p>
                                <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem;">Haga clic en "Agregar Producto" para añadir productos</p>
                            </div>
                        </div>
                    </div>

                    <!-- Total del pedido -->
                    <div class="form-group" style="background: #f0f9ff; padding: 1rem; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                        <div style="display: flex; justify-content: between; align-items: center;">
                            <span style="font-weight: 600; color: #0c4a6e;">Total del Pedido:</span>
                            <span id="edit-order-total" style="font-size: 1.5rem; font-weight: bold; color: #0ea5e9;">$0.00</span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary close-modal cancel-btn">Cancelar</button>
                <button type="submit" form="edit-order-form" class="btn btn-primary submit-btn">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <!-- Modal de Nuevo Contacto -->
    <div id="new-contact-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nuevo Contacto</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-form">
                <form id="new-contact-form">
                    <div class="form-group">
                        <label for="contact-client-select">Cliente</label>
                        <select id="contact-client-select" class="input" autocomplete="off" required>
                            <option value="">Seleccione un cliente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="contact-name-input">Nombre Completo</label>
                        <input type="text" id="contact-name-input" class="input" autocomplete="name" required>
                    </div>
                    <div class="form-group">
                        <label for="contact-email-input">Email</label>
                        <input type="email" id="contact-email-input" class="input" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label for="contact-phone-input">Teléfono</label>
                        <input type="tel" id="contact-phone-input" class="input" autocomplete="tel" required>
                    </div>
                    <div class="form-group">
                        <label for="contact-position-input">Cargo</label>
                        <input type="text" id="contact-position-input" class="input" autocomplete="organization-title" required>
                    </div>
                    <div class="form-group">
                        <label for="contact-department-input">Departamento</label>
                        <input type="text" id="contact-department-input" class="input" autocomplete="off">
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary close-modal cancel-btn">Cancelar</button>
                <button type="submit" form="new-contact-form" class="btn btn-primary submit-btn" style="background-color: #FF6B00;">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Editar Cliente -->
    <div id="edit-client-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Editar Cliente</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-form">
                <form id="edit-client-form">
                    <div class="form-group">
                        <label for="edit-client-name">Nombre</label>
                        <input type="text" id="edit-client-name" class="input" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-client-cuit">Documento</label>
                        <input type="text" id="edit-client-cuit" class="input" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-client-email">Email</label>
                        <input type="email" id="edit-client-email" class="input" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-client-phone">Teléfono</label>
                        <input type="tel" id="edit-client-phone" class="input" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-client-address">Dirección de Entrega</label>
                        <input type="text" id="edit-client-address" class="input" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-client-province">Provincia</label>
                        <select id="edit-client-province" class="input" required>
                            <option value="">Seleccione una provincia</option>
                            <option value="Buenos Aires">Buenos Aires</option>
                            <option value="Ciudad Autonoma de Buenos Aires">Ciudad Autónoma de Buenos Aires</option>
                            <option value="Catamarca">Catamarca</option>
                            <option value="Chaco">Chaco</option>
                            <option value="Chubut">Chubut</option>
                            <option value="Cordoba">Córdoba</option>
                            <option value="Corrientes">Corrientes</option>
                            <option value="Entre Rios">Entre Ríos</option>
                            <option value="Formosa">Formosa</option>
                            <option value="Jujuy">Jujuy</option>
                            <option value="La Pampa">La Pampa</option>
                            <option value="La Rioja">La Rioja</option>
                            <option value="Mendoza">Mendoza</option>
                            <option value="Misiones">Misiones</option>
                            <option value="Neuquen">Neuquén</option>
                            <option value="Rio Negro">Río Negro</option>
                            <option value="Salta">Salta</option>
                            <option value="San Juan">San Juan</option>
                            <option value="San Luis">San Luis</option>
                            <option value="Santa Cruz">Santa Cruz</option>
                            <option value="Santa Fe">Santa Fe</option>
                            <option value="Santiago del Estero">Santiago del Estero</option>
                            <option value="Tierra del Fuego">Tierra del Fuego</option>
                            <option value="Tucuman">Tucumán</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-client-city">Ciudad</label>
                        <select id="edit-client-city" class="input" required>
                            <option value="">Seleccione una ciudad</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-client-locality">Localidad</label>
                        <select id="edit-client-locality" class="input" required>
                            <option value="">Seleccione una localidad</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-client-zip">Código Postal</label>
                        <input type="text" id="edit-client-zip" class="input" required>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary close-modal cancel-btn">Cancelar</button>
                <button type="submit" form="edit-client-form" class="btn btn-primary submit-btn">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <!-- Sección de Administración de Perfiles (pantalla completa, rediseñada) -->
    <div id="admin-profiles-section" style="display:none;">
        <header class="header">
            <div class="flex items-center gap-2">
                <button class="btn btn-secondary" id="back-to-dashboard-btn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>Gestión de Usuarios y Perfiles</h1>
            </div>
        </header>
        <div class="page-content">
            <div class="admin-panel">
                <div class="flex justify-between items-center mb-4">
                    <h2>Usuarios</h2>
                    <button class="btn btn-primary" id="new-user-btn">
                        <i class="fas fa-user-plus"></i> Nuevo Usuario
                    </button>
                </div>
                <div class="users-table-container"></div>
                <h2>Permisos por Perfil</h2>
                <div class="perms-table-container"></div>
            </div>
        </div>
    </div>

    <!-- Modal de Nuevo Usuario -->
    <div id="new-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nuevo Usuario</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="new-user-form">
                <div class="form-group">
                    <label for="new-user-nombre">Nombre</label>
                    <input type="text" id="new-user-nombre" class="input" required>
                </div>
                <div class="form-group">
                    <label for="new-user-email">Email</label>
                    <input type="email" id="new-user-email" class="input" required>
                </div>
                <div class="form-group">
                    <label for="new-user-perfil">Perfil</label>
                    <select id="new-user-perfil" class="input" required>
                        <option value="">Seleccione un perfil</option>
                        <option value="Administrador">Administrador</option>
                        <option value="Vendedor">Vendedor</option>
                        <option value="Produccion">Producción</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="new-user-password">Contraseña</label>
                    <input type="password" id="new-user-password" class="input" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel-btn close-modal">Cancelar</button>
                    <button type="submit" class="btn submit-btn">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Editar Usuario -->
    <div id="edit-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Editar Usuario</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="edit-user-form">
                <div class="form-group">
                    <label for="edit-user-nombre">Nombre</label>
                    <input type="text" id="edit-user-nombre" class="input" required>
                </div>
                <div class="form-group">
                    <label for="edit-user-email">Email</label>
                    <input type="email" id="edit-user-email" class="input" required>
                </div>
                <div class="form-group">
                    <label for="edit-user-perfil">Perfil</label>
                    <select id="edit-user-perfil" class="input" required>
                        <option value="">Seleccione un perfil</option>
                        <option value="Administrador">Administrador</option>
                        <option value="Vendedor">Vendedor</option>
                        <option value="Produccion">Producción</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-user-password">Contraseña</label>
                    <input type="password" id="edit-user-password" class="input" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel-btn close-modal">Cancelar</button>
                    <button type="submit" class="btn submit-btn">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Nuevo Producto -->
    <div id="new-product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nuevo Producto</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-form">
                <form id="new-product-form">
                    <div class="form-group">
                        <label for="product-name-input">Nombre del Producto</label>
                        <input type="text" id="product-name-input" name="nombre" class="input" required>
                    </div>
                    <div class="form-group">
                        <label for="product-description-input">Descripción</label>
                        <textarea id="product-description-input" name="descripcion" class="input" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="product-price-input">Precio</label>
                        <input type="number" id="product-price-input" name="precio" class="input" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="product-stock-input">Stock</label>
                        <input type="number" id="product-stock-input" name="stock" class="input" min="0" required>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary close-modal cancel-btn">Cancelar</button>
                <button type="submit" form="new-product-form" class="btn btn-primary submit-btn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Preferencias de Usuario -->
    <div id="user-config-modal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 class="modal-title">Preferencias de Usuario</h2>
                <button class="close-modal btn btn-secondary" title="Cerrar" aria-label="Cerrar modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="user-config-form">
                <div class="avatar-section">
                    <label class="avatar-label">
                        <img id="user-avatar-preview" class="avatar-img" src="https://ui-avatars.com/api/?name=Usuario" alt="Avatar">
                        <span class="avatar-edit-text">Cambiar avatar</span>
                        <input type="file" id="user-avatar-input" accept="image/*" style="display:none;">
                    </label>
                </div>
                <div class="form-group">
                    <label for="user-config-nombre">Nombre</label>
                    <input type="text" id="user-config-nombre" class="input" required>
                </div>
                <div class="form-group">
                    <label for="user-config-email">Email</label>
                    <input type="email" id="user-config-email" class="input" required>
                </div>
                <div class="form-group">
                    <label for="user-config-perfil">Perfil</label>
                    <input type="text" id="user-config-perfil" class="input" disabled>
                </div>
                <div class="form-group">
                    <label for="user-theme-select">Tema</label>
                    <select id="user-theme-select" class="input">
                        <option value="light">Claro</option>
                        <option value="dark">Oscuro</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel-btn close-modal">Cancelar</button>
                    <button type="submit" class="btn submit-btn">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Clientes Inactivos -->
    <div id="inactive-clients-modal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Clientes Inactivos - Sin pedidos en 30 días</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem;">
                    <input type="text" id="inactive-clients-search" class="input" placeholder="Buscar cliente..." style="width: 100%;">
                </div>
                <div class="table-responsive">
                    <table class="clients-table">
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Email</th>
                                <th>Teléfono</th>
                                <th>Último Pedido</th>
                                <th>Días Sin Actividad</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="inactive-clients-table-body">
                            <!-- Los clientes inactivos se cargarán aquí -->
                        </tbody>
                    </table>
                </div>
                <div id="no-inactive-clients" style="display: none; text-align: center; padding: 2rem; color: #6b7280;">
                    <i class="fas fa-thumbs-up" style="font-size: 3rem; color: #10b981; margin-bottom: 1rem;"></i>
                    <h3 style="color: #10b981; margin: 0;">¡Excelente!</h3>
                    <p style="margin: 0.5rem 0 0 0;">Todos los clientes han realizado pedidos recientemente</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cobros Pendientes -->
    <div id="pending-collections-modal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">Resumen de Cobros Pendientes</h2>
                <button class="close-modal btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="summary-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 8px; padding: 1rem; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #92400e;" id="summary-total-orders">$0</div>
                        <div style="font-size: 0.875rem; color: #92400e;">Total Pedidos</div>
                    </div>
                    <div style="background: #d1fae5; border: 1px solid #6ee7b7; border-radius: 8px; padding: 1rem; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #047857;" id="summary-total-payments">$0</div>
                        <div style="font-size: 0.875rem; color: #047857;">Total Pagos</div>
                    </div>
                    <div style="background: #fee2e2; border: 1px solid #fca5a5; border-radius: 8px; padding: 1rem; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #dc2626;" id="summary-pending-amount">$0</div>
                        <div style="font-size: 0.875rem; color: #dc2626;">Por Cobrar</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <input type="text" id="pending-collections-search" class="input" placeholder="Buscar cliente..." style="width: 100%;">
                </div>
                
                <div class="table-responsive">
                    <table class="clients-table">
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Total Pedidos</th>
                                <th>Total Pagos</th>
                                <th>Saldo Pendiente</th>
                                <th>% Pagado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="pending-collections-table-body">
                            <!-- Los datos de cobros se cargarán aquí -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
